<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Job Search Workflow</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="module">
    import React, { useState } from 'https://esm.sh/react@18';
    import ReactDOM from 'https://esm.sh/react-dom@18/client';
    import { Upload, Briefcase, Link, Send, CheckCircle, AlertCircle, FileText } from 'https://esm.sh/lucide-react@0.263.1';

    function N8NWorkflowForm() {
      const [formData, setFormData] = useState({
        cvFile: null,
        cvText: '',
        cvPastedText: '',
        linkedinUrls: '',
        rigzoneUrls: '',
        n8nWebhookUrl: '',
        inputMethod: 'paste'
      });
      const [status, setStatus] = useState({ type: '', message: '' });
      const [loading, setLoading] = useState(false);

      const handleFileUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          setFormData({ ...formData, cvFile: file, inputMethod: 'upload' });
          
          const reader = new FileReader();
          reader.onload = (event) => {
            const base64String = event.target.result;
            setFormData(prev => ({ 
              ...prev, 
              cvText: base64String,
              isBase64: true 
            }));
          };
          
          reader.readAsDataURL(file);
        }
      };

      const handleSubmit = async () => {
        setLoading(true);
        setStatus({ type: '', message: '' });

        try {
          if (!formData.n8nWebhookUrl) {
            throw new Error('Please enter your unique webhook URL');
          }

          const cvContent = formData.inputMethod === 'paste' ? formData.cvPastedText : formData.cvText;
          
          if (!cvContent || cvContent.trim().length === 0) {
            throw new Error('Please either upload a CV file or paste your CV text');
          }

          const linkedinLinks = formData.linkedinUrls
            .split('\n')
            .map(url => url.trim())
            .filter(url => url.length > 0);
          
          const rigzoneLinks = formData.rigzoneUrls
            .split('\n')
            .map(url => url.trim())
            .filter(url => url.length > 0);

          const payload = {
            cvData: cvContent,
            cvFileName: formData.inputMethod === 'upload' ? (formData.cvFile?.name || 'cv.txt') : 'pasted-cv.txt',
            cvFileType: formData.inputMethod === 'upload' ? (formData.cvFile?.type || 'text/plain') : 'text/plain',
            inputMethod: formData.inputMethod,
            jobLinks: {
              linkedin: linkedinLinks,
              rigzone: rigzoneLinks
            },
            timestamp: new Date().toISOString()
          };

          console.log('Uploading.....:', payload);

          const response = await fetch(formData.n8nWebhookUrl, {
            method: 'POST',
            mode: 'cors',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload)
          });

          console.log('Response status:', response.status);

          if (!response.ok) {
            const errorText = await response.text();
            console.error('Error response:', errorText);
            throw new Error(`Workflow request failed: ${response.status} ${response.statusText}`);
          }

          const result = await response.json().catch(() => ({}));
          console.log('Success response:', result);

          setStatus({
            type: 'success',
            message: 'Successfully uploaded your details.'
          });

          setFormData({
            ...formData,
            cvFile: null,
            cvText: '',
            cvPastedText: '',
            linkedinUrls: '',
            rigzoneUrls: '',
            inputMethod: 'paste'
          });

        } catch (err) {
          console.error('Submit error:', err);
          setStatus({
            type: 'error',
            message: err.message || 'Failed to upload your data, try again ensuring that all fields have been correctly entered.'
          });
        } finally {
          setLoading(false);
        }
      };

      return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4' },
        React.createElement('div', { className: 'max-w-4xl mx-auto' },
          React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl p-8' },
            React.createElement('div', { className: 'text-center mb-8' },
              React.createElement('div', { className: 'flex justify-center mb-4' },
                React.createElement(Briefcase, { className: 'w-16 h-16 text-indigo-600' })
              ),
              React.createElement('h1', { className: 'text-3xl font-bold text-gray-900 mb-2' }, 'Job Search Workflow'),
              React.createElement('p', { className: 'text-gray-600' }, 'Upload your CV and add job links to continue')
            ),
            React.createElement('div', { className: 'space-y-6' },
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-semibold text-gray-700 mb-2' }, 'N8N Webhook URL *'),
                React.createElement('input', {
                  type: 'url',
                  value: formData.n8nWebhookUrl,
                  onChange: (e) => setFormData({ ...formData, n8nWebhookUrl: e.target.value }),
                  placeholder: 'https://your-unique-n8n-instance.com/webhook/...',
                  className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent'
                }),
                React.createElement('p', { className: 'text-xs text-gray-500 mt-1' }, 'Enter your unique n8n webhook URL')
              ),
              
              React.createElement('div', { className: 'border-2 border-gray-200 rounded-lg p-6 bg-gray-50' },
                React.createElement('label', { className: 'block text-sm font-semibold text-gray-700 mb-3' }, 'CV Input Method *'),
                React.createElement('div', { className: 'flex gap-4 mb-4' },
                  React.createElement('button', {
                    onClick: () => setFormData({ ...formData, inputMethod: 'paste', cvFile: null, cvText: '' }),
                    className: `flex-1 py-3 px-4 rounded-lg font-semibold transition-colors ${
                      formData.inputMethod === 'paste' 
                        ? 'bg-indigo-600 text-white' 
                        : 'bg-white text-gray-700 border-2 border-gray-300 hover:border-indigo-400'
                    }`
                  },
                    React.createElement(FileText, { className: 'w-5 h-5 inline mr-2' }),
                    'Paste Text'
                  ),
                  React.createElement('button', {
                    onClick: () => setFormData({ ...formData, inputMethod: 'upload', cvPastedText: '' }),
                    className: `flex-1 py-3 px-4 rounded-lg font-semibold transition-colors ${
                      formData.inputMethod === 'upload' 
                        ? 'bg-indigo-600 text-white' 
                        : 'bg-white text-gray-700 border-2 border-gray-300 hover:border-indigo-400'
                    }`
                  },
                    React.createElement(Upload, { className: 'w-5 h-5 inline mr-2' }),
                    'Upload File'
                  )
                )
              ),

              formData.inputMethod === 'paste' && React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-semibold text-gray-700 mb-2' },
                  React.createElement(FileText, { className: 'w-4 h-4 inline mr-2' }),
                  'Paste Your CV Text *'
                ),
                React.createElement('textarea', {
                  value: formData.cvPastedText,
                  onChange: (e) => setFormData({ ...formData, cvPastedText: e.target.value }),
                  rows: 12,
                  placeholder: 'Paste your CV content here...\n\nExample:\nJohn Doe\nSenior Engineer\nEmail: john@example.com\n\nExperience:\n- Company A (2020-2023)\n- Company B (2018-2020)\n\nSkills:\n- JavaScript, Python, React...',
                  className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-mono text-sm'
                }),
                React.createElement('p', { className: 'text-xs text-gray-500 mt-1' }, 'Or copy your CV text and paste it here')
              ),

              formData.inputMethod === 'upload' && React.createElement('div', null,
                React.createElement('div', { className: 'border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-indigo-400 transition-colors' },
                  React.createElement('label', { className: 'block text-sm font-semibold text-gray-700 mb-3' },
                    React.createElement(Upload, { className: 'w-5 h-5 inline mr-2' }),
                    'Upload CV File *'
                  ),
                  React.createElement('input', {
                    type: 'file',
                    onChange: handleFileUpload,
                    accept: '.txt,.doc,.docx',
                    className: 'w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100'
                  }),
                  formData.cvFile && React.createElement('p', { className: 'text-sm text-green-600 mt-2 flex items-center' },
                    React.createElement(CheckCircle, { className: 'w-4 h-4 mr-1' }),
                    formData.cvFile.name
                  )
                ),
                React.createElement('div', { className: 'mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg' },
                  React.createElement('p', { className: 'text-xs text-yellow-800 font-semibold' }, 'âš ï¸ Note: PDF files are not supported'),
                  React.createElement('p', { className: 'text-xs text-yellow-700 mt-1' }, 
                    'Please upload Word documents (.doc, .docx, .rtf or .txt) only. Or you can use the "Copy / Paste Text" option instead.'
                  )
                ),
                formData.cvText && React.createElement('div', { className: 'mt-4' },
                  React.createElement('label', { className: 'block text-sm font-semibold text-gray-700 mb-2' }, 'CV File Ready'),
                  React.createElement('div', { className: 'p-4 bg-green-50 border border-green-200 rounded-lg' },
                    React.createElement('p', { className: 'text-sm text-green-700' },
                      `File: ${formData.cvFile?.name || 'Unknown'}`,
                      React.createElement('br'),
                      `Type: ${formData.cvFile?.type || 'Unknown'}`,
                      React.createElement('br'),
                      `Size: ${formData.cvFile ? (formData.cvFile.size / 1024).toFixed(2) + ' KB' : 'Unknown'}`
                    )
                  )
                )
              ),

              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-semibold text-gray-700 mb-2' },
                  React.createElement(Link, { className: 'w-4 h-4 inline mr-2' }),
                  'LinkedIn Job Links'
                ),
                React.createElement('textarea', {
                  value: formData.linkedinUrls,
                  onChange: (e) => setFormData({ ...formData, linkedinUrls: e.target.value }),
                  rows: 4,
                  placeholder: 'https://www.linkedin.com/jobs/view/123456789\nhttps://www.linkedin.com/jobs/view/987654321\n(One URL per line)',
                  className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent'
                }),
                React.createElement('p', { className: 'text-xs text-gray-500 mt-1' }, 'Enter one LinkedIn job URL per line')
              ),
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-semibold text-gray-700 mb-2' },
                  React.createElement(Link, { className: 'w-4 h-4 inline mr-2' }),
                  'RigZone Job Links'
                ),
                React.createElement('textarea', {
                  value: formData.rigzoneUrls,
                  onChange: (e) => setFormData({ ...formData, rigzoneUrls: e.target.value }),
                  rows: 4,
                  placeholder: 'https://www.rigzone.com/jobs/posting/123456\nhttps://www.rigzone.com/jobs/posting/654321\n(One URL per line)',
                  className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent'
                }),
                React.createElement('p', { className: 'text-xs text-gray-500 mt-1' }, 'Enter one RigZone job URL per line')
              ),
              status.message && React.createElement('div', { 
                className: `p-4 rounded-lg flex items-start ${status.type === 'success' ? 'bg-green-50 text-green-800 border border-green-200' : 'bg-red-50 text-red-800 border border-red-200'}`
              },
                status.type === 'success' ? 
                  React.createElement(CheckCircle, { className: 'w-5 h-5 mr-2 flex-shrink-0 mt-0.5' }) :
                  React.createElement(AlertCircle, { className: 'w-5 h-5 mr-2 flex-shrink-0 mt-0.5' }),
                React.createElement('span', null, status.message)
              ),
              React.createElement('button', {
                onClick: handleSubmit,
                disabled: loading,
                className: 'w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center'
              },
                loading ? 
                  React.createElement(React.Fragment, null,
                    React.createElement('div', { className: 'animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2' }),
                    'Processing...'
                  ) :
                  React.createElement(React.Fragment, null,
                    React.createElement(Send, { className: 'w-5 h-5 mr-2' }),
                    'Submit to Workflow'
                  )
              )
            ),
            React.createElement('div', { className: 'mt-8 pt-6 border-t border-gray-200' },
              React.createElement('h3', { className: 'text-sm font-semibold text-gray-700 mb-2' }, 'How it works:'),
              React.createElement('ul', { className: 'text-sm text-gray-600 space-y-1' },
                React.createElement('li', null, '1. Enter your unique webhook URL'),
                React.createElement('li', null, '2. Choose to paste CV text or upload a Word/text file (PDFs are not supported)'),
                React.createElement('li', null, '3. Paste 3 job links from LinkedIn and RigZone (one per line)'),
                React.createElement('li', null, '4. Submit to upload data to your unique job search engine')
              ),
              React.createElement('div', { className: 'mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg' },
                React.createElement('h4', { className: 'text-sm font-semibold text-blue-800 mb-2' }, 'ðŸ’¡ Tips: For best Job Search Links'),
                React.createElement('p', { className: 'text-sm text-blue-700' },
                  'Sign-in to your account and create search links using your desired position and Country for 3 different locations: ',
                  React.createElement('a', { 
                    href: 'https://www.rigzone.com/oil/jobs/', 
                    target: '_blank',
                    rel: 'noopener noreferrer',
                    className: 'font-semibold underline hover:text-blue-900'
                  }, 'RigZone'),
                  ' and ',
                  React.createElement('a', { 
                    href: 'https://www.linkedin.com/home', 
                    target: '_blank',
                    rel: 'noopener noreferrer',
                    className: 'font-semibold underline hover:text-blue-900'
                  }, 'LinkedIn')
                )
              )
            )
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(N8NWorkflowForm));
  </script>
</body>
</html>
